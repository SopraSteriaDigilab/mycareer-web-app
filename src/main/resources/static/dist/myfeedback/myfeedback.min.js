function initFeedbackDatePicker(e,t){$("#"+e+"-date-picker").datepicker({useCurrent:!0,forceParse:!1,disabled:!0,format:"dd-mm-yyyy",startDate:t,orientation:"bottom",autoclose:!0}),$("#feedback-start-date, #feedback-end-date").val(timeStampToClassDate(new Date))}function addGeneralFeedbackToList(e,t,a,d,i,s,l,c){$("#general-feedback-tab").append(feedbackSendersListHTML(e,t,d,i,s,l,c)),$("#generalFeeDescription").append(feedbackDescriptionListHTML(e,t,a,d,i,s,l,c)),reviewerExists(s)||$("#general-reviewer-list").append(feedbackReviewersListHTML(t,s))}function selectedFeedback(e){$(".sender-panel").each(function(t){e.id==this.id?$(this).addClass("selected-panel"):$(this).removeClass("selected-panel")})}function feedbackSendersListHTML(e,t,a,d,i,s,l){return"         <div class='panel panel-default sender-panel filterable-feedback' id='view-fee-"+e+"' style='cursor:pointer' onClick='selectedFeedback(this)'>         \t<input type='hidden' class='reviewer-filter' value='"+i+"'>         \t<input type='hidden' class='date-filter' value='"+d+"'> \t  \t\t<input type='hidden' class='feedback-tag-filter feedback-tag-filter-"+e+"' value='"+formatTagFilterValues(s,l)+"'> \t        <div class='panel-heading' onClick='showGeneralFeedback("+e+")'> \t            <div class='row'> \t               <div class='col-md-7 wrap-text'><h5><b>"+t+"</b></h5></div> \t               <div class='col-md-5'><h6 class='pull-right'><b>"+a+"</b></h6></div> \t            </div> \t        </div> \t     </div> "}function feedbackReviewersListHTML(e,t){return" \t\t<div class='row'> \t\t\t<div class='col-md-12 wrap-only'> \t\t\t\t<label class='reviewer-label' style='max-width: 80%;''> \t\t\t\t<input class='reviewer-checkbox pull-right' type='checkbox' value='"+t+"' style='right:35px'> \t\t\t\t"+e+" \t\t\t\t</label> \t\t</div>"}function feedbackDescriptionListHTML(e,t,a,d,i,s,l,c){return" \t<div class='panel panel-default filterable-feedback feedback-description hidden' id='feedback-"+e+"'> \t\t<input type='hidden' class='reviewer-filter' value='"+s+"'> \t    <input type='hidden' class='date-filter' value='"+i+"'>   \t\t<input type='hidden' class='feedback-tag-filter feedback-tag-filter-"+e+"' value='"+formatTagFilterValues(l,c)+"'>     \t<input type='hidden' id='feedback-obj-tags-"+e+"' value='"+l+"'>     \t<input type='hidden' id='feedback-dev-need-tags-"+e+"' value='"+c+"'> \t\t<div class='panel-body'> \t\t\t<div class='row'> \t\t\t\t<div class='col-md-10'><h6 class='wrap-text' >Tags: <span id=feedback-tag-text-"+e+">"+addTags(l,c,"feedback")+"</span></h6></div>     \t\t\t<div class='col-md-2'><h6 class='pull-right btn-link' style='cursor:pointer' onclick='openAddTagModalFeedback("+e+")'><b>Tags</b></h6></div>     \t\t</div> \t\t\t<div class='row'> \t\t\t\t<div class='col-md-6'><h6 id='from-"+e+"'><b>"+t+"</b></h6></div> \t\t\t\t<div class='col-md-6'><h6 class='pull-right' id='date-rec-"+e+"'><b>"+d+"</b></h6></div> \t\t\t</div> \t\t\t<div class='row'> \t\t\t\t<div class='col-md-12 wrap-text'><h5>"+a+"</h5></div> \t\t\t</div> \t\t </div> \t</div> "}function updateEndDate(){var e=formatFeedbackDate($("#feedback-start-date").val());e>formatFeedbackDate($("#feedback-end-date").val())&&$("#feedback-end-date").val(timeStampToClassDate(e)),$("#feedback-end-date-picker").datepicker("setStartDate",e)}function formatFeedbackDate(e){var t=e.slice(0,2),a=e.slice(3,5),d=e.slice(6,10);return new Date(d+"-"+a+"-"+t)}function applyDateFilter(){for(var e=[],t=formatFeedbackDate($("#feedback-start-date").val()),a=formatFeedbackDate($("#feedback-end-date").val()),d=t;d<=a;d=d.addDays(1))e.push(timeStampToClassDate(d));$(".date-filter").each(function(t){var a=$(this).val();jQuery.inArray(a,e)>-1?$(this).closest("div").removeClass("filteredOutByDate"):$(this).closest("div").addClass("filteredOutByDate")}),dateFilterApplied=!0,updateFilterView()}function applyReviewerFilter(){var e=[];$(".reviewer-checkbox").each(function(){1==$(this).prop("checked")&&e.push(this.value)}),0==e.length?clearReviewerFilter():($(".reviewer-filter").each(function(){var t=$(this).val();jQuery.inArray(t,e)>-1?$(this).closest("div").removeClass("filteredOutByReviewer"):$(this).closest("div").addClass("filteredOutByReviewer")}),reviewerFilterApplied=!0),updateFilterView()}function applyFeedbackTagFilter(e){0==e?clearFeedbackTagFilter():($(".feedback-tag-filter").each(function(){$(this).val().split(" ").indexOf(e)>-1?$(this).closest("div").removeClass("filteredOutByFeedbackTags"):$(this).closest("div").addClass("filteredOutByFeedbackTags")}),feedbackTagFilterApplied=!0),updateFilterView()}function updateFilterView(){$(".filterable-feedback").each(function(e){var t=$(this);t.hasClass("filteredOutByDate")||t.hasClass("filteredOutByReviewer")||t.hasClass("filteredOutByFeedbackTags")?t.hide():t.show()});var e="";dateFilterApplied||reviewerFilterApplied||feedbackTagFilterApplied?(dateFilterApplied&&(e+="Date: "+$("#feedback-start-date").val()+" to "+$("#feedback-end-date").val()+"."),reviewerFilterApplied&&(e+=" Reviewer."),feedbackTagFilterApplied&&(e+=" Tags.")):e="No Filters Applied",$("#filter-text").text(e)}function clearReviewerFilter(){$(".reviewer-checkbox").prop("checked",!1),$(".reviewer-filter").each(function(e){$(this).closest("div").removeClass("filteredOutByReviewer")}),reviewerFilterApplied=!1,updateFilterView()}function clearDateFilter(){$("#feedback-start-date, #feedback-end-date").val(timeStampToClassDate(new Date)),updateEndDate(),$(".filterable-feedback").each(function(e){$(this).closest("div").removeClass("filteredOutByDate")}),dateFilterApplied=!1,updateFilterView()}function clearFeedbackTagFilter(){$(".feedback-tag-filter").each(function(){$(this).closest("div").removeClass("filteredOutByFeedbackTags")}),$(".tag-filter-dropdown").selectpicker("val",0),feedbackTagFilterApplied=!1,updateFilterView()}function clearAllFilters(){clearReviewerFilter(),clearDateFilter(),clearFeedbackTagFilter()}function showGeneralFeedback(e){generalFeedbackID="feedback-"+e,$(".feedback-description").each(function(e){generalFeedbackID===this.id?$(this).removeClass("hidden"):$(this).addClass("hidden")})}function reviewerExists(e){var t=[];return $(".reviewer-checkbox").each(function(){t.push(this.value)}),jQuery.inArray(e,t)>-1}function openRequestFeedbackModal(){$("#requestFeedbackModal").modal({backdrop:"static",keyboard:!1,show:!0})}function openSendFeedbackModal(){$("#submit-send-feedback").prop("disabled",!0),$("#sendFeedbackModal").modal({backdrop:"static",keyboard:!1,show:!0})}function submitFeedbackRequest(){$("#nav-bar-buttons").append("<h5 class='pull-right'> Loading... <h5>"),$.ajax({url:"http://"+getEnvironment()+"/generateFeedbackRequest/"+getADLoginID(),method:"POST",xhrFields:{withCredentials:!0},data:{emailsTo:$("#requestingTo").val(),notes:$("#requestingText").val()},success:function(e){$("#nav-bar-buttons").empty(),toastr.success(e)},error:function(e,t,a){$("#nav-bar-buttons").empty(),toastr.error(e.responseText)}}),$("#request-feedback").click(function(){$("textarea").val(""),$("#requestingTo").tagsinput("removeAll")}),$("#requestFeedbackModal").modal("hide")}function submitSendFeedback(){$("#nav-bar-buttons").append("<h5 class='pull-right'> Loading... <h5>"),$.ajax({url:"http://"+getEnvironment()+"/addFeedback/"+getADLoginID(),method:"POST",xhrFields:{withCredentials:!0},data:{emails:$("#sendingTo").val(),feedback:$("#sendingText").val()},success:function(e){$("#nav-bar-buttons").empty(),toastr.success(e)},error:function(e,t,a){$("#nav-bar-buttons").empty();var d=e.responseText.toLowerCase();d.indexOf("feedback added")>-1?toastr.warning(e.responseText):toastr.error(d)}}),$("#send-feedback").click(function(){$("textarea").val(""),$("#sendingTo").tagsinput("removeAll")}),$("#sendFeedbackModal").modal("hide")}function openAddTagModalFeedback(e){var t=$("#feedback-obj-tags-"+e).val(),a=$("#feedback-dev-need-tags-"+e).val();updateTagCheckboxes(t,a),$("#tag-type").val("feedback"),openAddTagModal(e)}function updateFeedbackTags(e,t,a){$.ajax({url:"http://"+getEnvironment()+"/updateFeedbackTags/"+getADLoginID(),method:"POST",xhrFields:{withCredentials:!0},data:{feedbackId:e,objectiveIds:t.toString(),developmentNeedIds:a.toString()},success:function(d){toastr.success(d),$("#feedback-tag-text-"+e).text(addTags(t,a,"feedback")),setFeedbackTagValues(e,t,a),$("#add-tag-modal").modal("hide"),clearTagsCheckboxes()},error:function(e,t,a){$("#nav-bar-buttons").empty(),toastr.error(e.responseText)}})}function setFeedbackTagValues(e,t,a){$("#feedback-obj-tags-"+e).val(t),$("#feedback-dev-need-tags-"+e).val(a),$(".feedback-tag-filter-"+e).val(formatTagFilterValues(t,a))}function initialiseTags(){tags("requestingTo",emails),tags("sendingTo",emails)}$(function(){getGeneralFeedbackList(getADLoginID()),getEmailList(),initFeedbackDatePicker("feedback-start",""),initFeedbackDatePicker("feedback-end",new Date),$("#feedback-start-date").change(function(e){updateEndDate()}),$("#submit-date-filter").click(function(){applyDateFilter()}),$("#general-reviewer-list").change(function(){applyReviewerFilter()}),keypress("requestFeedbackModal"),keypress("sendFeedbackModal"),$(".send-feedback-validate").keyup(function(){validateForm("send-feedback-validate","submit-send-feedback")}),$("#request-feedback").click(function(){openRequestFeedbackModal()}),$("#send-feedback").click(function(){openSendFeedbackModal()}),$("#submit-request-feedback").click(function(){validEmails($("#requestingTo").val())?submitFeedbackRequest():toastr.error("One or more email addresses entered are not valid")}),$("#submit-send-feedback").click(function(){validEmails($("#sendingTo").val())?submitSendFeedback():toastr.error("One or more email addresses entered are not valid")}),$("#view-feedback-template").click(function(){$("#emailTemplateModal").modal("show")}),$("#view-feedback-suggestion-template").click(function(){$("#feedbackTemplateModal").modal("show")}),$("#cancelSendModal, #close-feedback-send-modal").on("click",function(e){clickCloseSendFeedback(e)}),$("#cancelRequestModal, #close-feedback-request-modal").on("click",function(e){clickCloseRequestFeedback(e)}),$("#feedback-tag-dropdown").on("change",function(){applyFeedbackTagFilter($(this).val())})});var dateFilterApplied=!1,reviewerFilterApplied=!1,feedbackTagFilterApplied=!1,firstFeedback=!0;